import React from 'react';
import { Badge } from 'react-bootstrap';

import { VulnerabilityItemProps } from './vulnerabilityItem.types.';
import { useVulnerabilityModal } from '../../../../context/vulnerabilitiesModalContext';

const VulnerabilityItem = ({ vul }: VulnerabilityItemProps): React.JSX.Element => {
  const { openEditor } = useVulnerabilityModal();
  const { id, title, severity, status, targets, source, tags, created_at } = vul;

  const date = new Date(created_at);
  const formattedDate = new Intl.DateTimeFormat('en-GB', {
    day: '2-digit',
    month: 'short',
    year: 'numeric',
  }).format(date);

  return (
    <tr key={id} onClick={() => openEditor(vul)} className="cursor-pointer">
      <td>
        <Badge
          bg={
            severity === 'critical'
              ? 'dark'
              : severity === 'high'
                ? 'danger'
                : severity === 'medium'
                  ? 'warning'
                  : 'success'
          }
        >
          {severity}
        </Badge>
      </td>
      <td>{title}</td>
      <td>{targets && targets.join(', ')}</td>
      <td>{source}</td>
      <td>{formattedDate}</td>
      <td>{tags && tags.join(', ')}</td>
      <td>
        <Badge bg={status === 'open' ? 'primary' : status === 'in progress' ? 'info' : 'secondary'}>
          {vul.status}
        </Badge>
      </td>
    </tr>
  );
};

export default VulnerabilityItem;
