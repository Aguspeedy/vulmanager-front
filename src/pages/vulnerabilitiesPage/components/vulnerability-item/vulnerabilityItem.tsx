import { JSX } from 'react';

import './vulnerabilityItem.css';
import { VulnerabilityItemProps } from './vulnerabilityItem.types.';
import { useVulnerabilityModal } from '../../../../context/vulnerabilitiesModalContext';
import { toCamelCase, formatDate } from '../../../../utils/functions';
import { statusIconMap, severityIconMap } from '../../../../utils/constants';
import { IconData } from '../../../../types/iconData.types';

const IconPill = ({ icon, title, cssClass }: IconData): JSX.Element => (
  <span className={`pill ${cssClass}`}>
    <i className={`${icon} me-1`} title={title}></i>
    {title}
  </span>
);

const VulnerabilityItem = ({ vul }: VulnerabilityItemProps): JSX.Element => {
  const { id, title, severity, status, targets, source, tags, created_at } = vul;
  const { openEditor } = useVulnerabilityModal();

  const statusMapping = status && statusIconMap[toCamelCase(status)];
  const severityMapping = severity && severityIconMap[severity];

  return (
    <tr key={id} onClick={() => openEditor(vul)} className="cursor-pointer">
      <td>{statusMapping && <IconPill {...statusMapping} />}</td>
      <td>{title}</td>
      <td>{targets && targets.join(', ')}</td>
      <td>{source}</td>
      <td>{tags && tags.join(', ')}</td>
      <td>{formatDate(created_at)}</td>
      <td>{severity && <IconPill {...severityMapping} />}</td>
    </tr>
  );
};

export default VulnerabilityItem;
